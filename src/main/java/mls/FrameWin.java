/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package mls;

import java.awt.Color;
import java.text.DecimalFormat;
import java.util.concurrent.Semaphore;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.SwingWorker;
import mls.generatori.Generatore3Erlangiano;
import mls.generatori.GeneratoreEsponenziale;
import mls.generatori.GeneratorePoissoniano;
import mls.generatori.GeneratoreUniforme;
import mls.util.Coda;
import mls.util.CodaFIFO;
import mls.util.CodaLIFO;
import mls.util.CodaSPTF;
import mls.util.Generatore;
import mls.util.JobComparator;
import mls.util.TipoEvento;

/**
 *
 * @author Michele Milidoni <michelemilidoni@gmail.com>
 */
public class FrameWin extends javax.swing.JFrame {

    //private PriorityQueue<Evento> calendario;
    private Calendario cal;
    private Coda<Job> cpuQueue;
    private Coda<Job> ioQueue;

    private Generatore genArrivi;
    private Generatore genCentroCpu;
    private Generatore genCentroIo;
    private GeneratoreUniforme genRouting;
    private Job jobCorrenteCpu;
    private Job jobCorrenteIO;
    private int pRun;
    private final int passo = 5;
    private int n0, nRun = 0, nOss = 0;
    private double uSommaG[];
    private double en[];
    private double vc[];
    private double x[];
    private double y[];
    private double uSommaStat;
    private boolean stopSequenziatore = false;
    private boolean stabile = false;
    private boolean convalida = false;

    private Coda<Job> cpuQueueStabile;
    private Coda<Job> ioQueueStabile;
    private Calendario calendarioStabile;
    private Job jobCorrenteCpuStabile;
    private Job jobCorrenteIOStabile;

    private final DecimalFormat df;
    private String testoOut = "";
    private boolean fineSimulazione = false;

    private final Semaphore semaforo;

    /**
     * Creates new form FrameWin
     */
    public FrameWin() {
        initComponents();
        buttonAvvia.setEnabled(true);
        buttonAvvia1.setEnabled(true);
        buttonStabile.setEnabled(false);
        df = new DecimalFormat("#.####");
        semaforo = new Semaphore(1);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jPanel1 = new javax.swing.JPanel();
        textTa = new javax.swing.JFormattedTextField();
        buttonAvvia = new javax.swing.JButton();
        jLabel4 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        textP = new javax.swing.JFormattedTextField();
        jLabel5 = new javax.swing.JLabel();
        textTs = new javax.swing.JFormattedTextField();
        buttonAvvia1 = new javax.swing.JButton();
        jSeparator5 = new javax.swing.JSeparator();
        jLabel7 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        textOutput = new javax.swing.JTextPane();
        jSeparator2 = new javax.swing.JSeparator();
        framePlot1 = new mls.FramePlot();
        buttonStabile = new javax.swing.JButton();
        jLabel8 = new javax.swing.JLabel();
        jSeparator3 = new javax.swing.JSeparator();
        jPanel3 = new javax.swing.JPanel();
        jSeparator4 = new javax.swing.JSeparator();
        jPanel4 = new javax.swing.JPanel();
        textPuntoCentrale = new javax.swing.JTextField();
        textLimiteSuperiore = new javax.swing.JTextField();
        jLabel13 = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        textLimiteInferiore = new javax.swing.JTextField();
        jPanel5 = new javax.swing.JPanel();
        textGeneratoreCentri = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        textCodaCPU = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        textGeneratoreArrivi = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        textCodaIO = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Milidoni MLS Parte2");
        setBackground(new java.awt.Color(254, 254, 254));

        jLabel1.setFont(new java.awt.Font("Ubuntu", 0, 24)); // NOI18N
        jLabel1.setText("Sistema simulato");

        jLabel2.setIcon(new javax.swing.ImageIcon("/home/michele/NetBeansProjects/MLS_Milidoni_Finale/src/main/java/mls/schema2.jpg")); // NOI18N

        jSeparator1.setOrientation(javax.swing.SwingConstants.VERTICAL);

        textTa.setText("30");

        buttonAvvia.setFont(new java.awt.Font("Ubuntu", 0, 18)); // NOI18N
        buttonAvvia.setText("Simula");
        buttonAvvia.setToolTipText("");
        buttonAvvia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonAvviaActionPerformed(evt);
            }
        });

        jLabel4.setText("Ta");

        jLabel6.setText("Run di stab. (p)");

        jLabel3.setFont(new java.awt.Font("Ubuntu", 0, 24)); // NOI18N
        jLabel3.setText("Configurazione");

        textP.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter()));
        textP.setText("30");
        textP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                textPActionPerformed(evt);
            }
        });

        jLabel5.setText("Ts");

        textTs.setText("2");
        textTs.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                textTsActionPerformed(evt);
            }
        });

        buttonAvvia1.setFont(new java.awt.Font("Ubuntu", 0, 18)); // NOI18N
        buttonAvvia1.setText("Convalida");
        buttonAvvia1.setToolTipText("");
        buttonAvvia1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonAvvia1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jLabel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(48, 48, 48))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(buttonAvvia, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jLabel6, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jLabel5, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.LEADING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(textTa)
                    .addComponent(textTs)
                    .addComponent(textP)
                    .addComponent(buttonAvvia1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jLabel3)
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(textTa, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(textTs, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(textP, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 38, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(buttonAvvia, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(buttonAvvia1, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)))
        );

        jSeparator5.setOrientation(javax.swing.SwingConstants.VERTICAL);

        jLabel7.setFont(new java.awt.Font("Ubuntu", 0, 24)); // NOI18N
        jLabel7.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel7.setText("Log");

        textOutput.setEditable(false);
        textOutput.setFont(new java.awt.Font("Andale Mono", 0, 12)); // NOI18N
        jScrollPane1.setViewportView(textOutput);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jLabel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 6, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel7, javax.swing.GroupLayout.PREFERRED_SIZE, 306, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 300, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(0, 0, 0))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel7)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 132, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addComponent(jSeparator5)
                    .addComponent(jSeparator1, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );

        buttonStabile.setFont(new java.awt.Font("Ubuntu", 0, 18)); // NOI18N
        buttonStabile.setText("SISTEMA STABILE");
        buttonStabile.setToolTipText("");
        buttonStabile.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonStabileActionPerformed(evt);
            }
        });

        jLabel8.setFont(new java.awt.Font("Ubuntu", 0, 24)); // NOI18N
        jLabel8.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel8.setText("Grafici");

        jSeparator4.setOrientation(javax.swing.SwingConstants.VERTICAL);

        textPuntoCentrale.setEditable(false);

        textLimiteSuperiore.setEditable(false);

        jLabel13.setText("Punto centrale:");

        jLabel15.setText("Limite superiore:");

        jLabel14.setText("Limite inferiore:");

        textLimiteInferiore.setEditable(false);

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel13)
                    .addComponent(jLabel14)
                    .addComponent(jLabel15))
                .addGap(13, 13, 13)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(textPuntoCentrale, javax.swing.GroupLayout.DEFAULT_SIZE, 202, Short.MAX_VALUE)
                    .addComponent(textLimiteInferiore)
                    .addComponent(textLimiteSuperiore))
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(textPuntoCentrale, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel14)
                    .addComponent(textLimiteInferiore, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel15)
                    .addComponent(textLimiteSuperiore, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        textGeneratoreCentri.setEditable(false);

        jLabel10.setText("Tipo generatore centri:");

        jLabel12.setText("Tipo coda I/O:");

        textCodaCPU.setEditable(false);

        jLabel11.setText("Tipo coda CPU:");

        textGeneratoreArrivi.setEditable(false);

        jLabel9.setText("Tipo generatore arrivi:");

        textCodaIO.setEditable(false);

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel9)
                    .addComponent(jLabel10)
                    .addComponent(jLabel11)
                    .addComponent(jLabel12))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(textGeneratoreArrivi, javax.swing.GroupLayout.DEFAULT_SIZE, 311, Short.MAX_VALUE)
                    .addComponent(textGeneratoreCentri)
                    .addComponent(textCodaCPU)
                    .addComponent(textCodaIO))
                .addContainerGap())
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(textGeneratoreArrivi, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel10)
                    .addComponent(textGeneratoreCentri, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(textCodaCPU, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel12)
                    .addComponent(textCodaIO, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator4, javax.swing.GroupLayout.PREFERRED_SIZE, 6, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jSeparator4)
            .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel5, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jSeparator2)
            .addComponent(jSeparator3)
            .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel8, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                .addComponent(buttonStabile, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(framePlot1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel8)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(framePlot1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(buttonStabile, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator3, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void buttonStabileActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonStabileActionPerformed
        try {
            semaforo.acquire();
            setStabile();
            buttonAvvia.setEnabled(false);
            buttonAvvia1.setEnabled(false);
            buttonStabile.setEnabled(false);
            buttonStabile.setText("CALCOLO INTERVALLO DI CONFIDENZA IN CORSO");
            semaforo.release();
        } catch (InterruptedException ex) {
            Logger.getLogger(FrameWin.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_buttonStabileActionPerformed

    private void buttonAvvia1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonAvvia1ActionPerformed
        convalida = true;
        SwingWorker worker = new SwingWorker<Boolean, Void>() {
            @Override
            protected Boolean doInBackground() throws Exception {
                avviaSimulazione(Integer.parseInt(textP.getText()),
                        Double.parseDouble(textTa.getText()),
                        Double.parseDouble(textTs.getText()));
                return true;
            }
        };

        buttonAvvia.setEnabled(false);
        buttonAvvia1.setEnabled(false);
        buttonStabile.setEnabled(true);
        worker.execute();
    }//GEN-LAST:event_buttonAvvia1ActionPerformed

    private void textTsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_textTsActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_textTsActionPerformed

    private void textPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_textPActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_textPActionPerformed

    private void buttonAvviaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonAvviaActionPerformed

        convalida = false;
        SwingWorker worker = new SwingWorker<Boolean, Void>() {
            @Override
            protected Boolean doInBackground() throws Exception {
                avviaSimulazione(Integer.parseInt(textP.getText()),
                        Double.parseDouble(textTa.getText()),
                        Double.parseDouble(textTs.getText()));
                return true;
            }
        };

        buttonAvvia.setEnabled(false);
        buttonAvvia1.setEnabled(false);
        buttonStabile.setEnabled(true);
        worker.execute();
    }//GEN-LAST:event_buttonAvviaActionPerformed

    private final double semeArrivi = 229;
    private final double semeCentroCpu = 233;
    private final double semeCentroIo = 283;
    private final double semeRouting = 227;
    private double semeArriviStabile = 229;
    private double semeCentriStabile = 233;
    private double semeRoutingStabile = 227;

    public void avviaSimulazione(int pRun, double Ta, double Ts) {
        double gamma = 1 / Ta;
        double mu = 1 / Ts;
        textLimiteInferiore.setText("");
        textLimiteSuperiore.setText("");
        textPuntoCentrale.setText("");

        textOutput.setText("");
        testoOut = "---------------- INIZIO SIMULAZIONE ---------------- \n";
        int nMax = 2000;
        genRouting = new GeneratoreUniforme(semeRouting);
        if (convalida) {
            genArrivi = new GeneratorePoissoniano(Ta, new GeneratoreUniforme(semeArrivi));
            genCentroCpu = new GeneratoreEsponenziale(Ts, new GeneratoreUniforme(semeCentroCpu));
            genCentroIo = new GeneratoreEsponenziale(Ts, new GeneratoreUniforme(semeCentroIo));
        } else {
            genArrivi = new GeneratoreEsponenziale(Ta, new GeneratoreUniforme(semeArrivi));
            genCentroCpu = new Generatore3Erlangiano(Ts, semeCentroCpu);
            genCentroIo = new Generatore3Erlangiano(Ts, semeCentroIo);
        }

        statoIniziale();

        textGeneratoreArrivi.setText(genArrivi.getClass().getName());
        textGeneratoreCentri.setText(genCentroCpu.getClass().getName());
        textCodaCPU.setText(cpuQueue.getClass().getName());
        textCodaIO.setText(ioQueue.getClass().getName());

        en = new double[nMax];
        vc = new double[nMax];
        fineSimulazione = false;
        nRun = 0;
        nOss = 0;
        stabile = false;
        stopSequenziatore = false;

        this.pRun = pRun;
        uSommaG = new double[pRun];
        testoOut += " ---> fase stabilizzazione con " + pRun + " run <--- \n";
        framePlot1.resetSerieMedia();
        framePlot1.resetSerieVarianza();
        //cal.setArrivo(new Evento(cal.getClock() + genArrivi.next(), TipoEvento.ARRIVO));
        for (int n = passo; n <= nMax && !fineSimulazione; n += passo) {
            setN0(n);
            sequenziatore();
        }
    }

    private void statoIniziale() {
        if (convalida) {
            cpuQueue = new CodaFIFO<>();
            ioQueue = new CodaFIFO<>();
        } else {
            cpuQueue = new CodaSPTF<>(new JobComparator());
            ioQueue = new CodaLIFO<>();
        }

        genArrivi.setSeme(semeArrivi);
        genCentroCpu.setSeme(semeCentroCpu);
        genCentroIo.setSeme(semeCentroIo);
        genRouting.setSeme(semeRouting);

        cal = new Calendario();
        cal.setArrivo(new Evento(cal.getClock() + genArrivi.next(), TipoEvento.ARRIVO));
        jobCorrenteCpu = null;
        jobCorrenteIO = null;
        nOss = 0;
    }

    private void sequenziatore() {
        while (!stopSequenziatore) {
            Evento e = cal.next();
            if (null != e.getTipo()) {
                switch (e.getTipo()) {
                    case ARRIVO:
                        arrivo();
                        break;
                    case FINE_CPU:
                        fineCPU();
                        break;
                    case FINE_IO:
                        fineIO();
                        break;
                    case FINE_SIMULAZIONE:
                        fineSimulazione();
                        break;
                    default:
                        break;
                }
            }
        }
    }

    private void arrivo() {
        cal.setArrivo(new Evento(cal.getClock() + genArrivi.next(), TipoEvento.ARRIVO));

        Job job = new Job();
        job.setTempoArrivo(cal.getClock());
        job.setTempoProcessamento(genCentroCpu.next());

        if (jobCorrenteCpu == null) {
            jobCorrenteCpu = job;
            cal.setCpu(new Evento(cal.getClock() + job.getTempoProcessamento(), TipoEvento.FINE_CPU));
        } else {
            cpuQueue.metti(job);
        }
    }

    private void fineCPU() {
        double routing = genRouting.next();
        if (routing < 0.9) {
            Job temp = jobCorrenteCpu.clona();
            jobCorrenteCpu = null;
            if (jobCorrenteIO == null) {
                jobCorrenteIO = temp;
                jobCorrenteIO.setTempoProcessamento(genCentroIo.next());
                cal.setIo(new Evento(cal.getClock() + jobCorrenteIO.getTempoProcessamento(), TipoEvento.FINE_IO));
                //System.out.println("imposto jobCorrenteIO da CPU");
            } else {
                ioQueue.metti(temp);
                //System.out.println("metto il job in lifoQueue");
            }

        } else {
            jobCorrenteCpu.setTempoUscita(cal.getClock());
            if (!stabile) {
                //getStatoCorrente();
                try {
                    semaforo.acquire();
                } catch (InterruptedException ex) {
                    Logger.getLogger(FrameWin.class.getName()).log(Level.SEVERE, null, ex);
                }
                //System.out.print("Aggiungo a uSommaG: " + jobCorrenteCpu.getTempoRisposta());
                uSommaG[nRun++] += jobCorrenteCpu.getTempoRisposta();
                //System.out.println("TR: " + jobCorrenteCpu.getTempoRisposta());
                //System.out.println("\tRun" + (nRun - 1) + "):\t" + uSommaG[(nRun - 1)]);
                jobCorrenteCpu = null;

                if (nRun == pRun) {
                    nOss++;
                    if (nOss == n0) {
                        testoOut += "  Osservazioni: " + n0 + "\n";

                        double temp = 0;
                        for (int jj = 0; jj < pRun; jj++) {
                            temp += uSommaG[jj] / n0;
                        }
                        en[n0 - 1] = temp / pRun;
                        testoOut += "   Media campionaria e(" + n0 + "): " + df.format(en[n0 - 1]) + "\n";
//                System.out.println("   Media campionaria e(" + n0 + "): " + df.format(en[n0 - 1]) + "\n");

                        double temp2 = 0;
                        for (int jj = 0; jj < pRun; jj++) {
                            temp2 += Math.pow(uSommaG[jj] / n0 - en[n0 - 1], 2);
                        }
                        vc[n0 - 1] = temp2 / (pRun - 1);
                        testoOut += "   Varianza campionaria s(" + n0 + "): " + df.format(vc[n0 - 1]) + "\n";

                        framePlot1.addSerieMedia(n0 - 1, en[n0 - 1]);
                        framePlot1.addSerieVarianza(n0 - 1, vc[n0 - 1]);

                        nRun = 0;

                        uSommaG = new double[pRun];

                        statoIniziale();
                        stopSequenziatore = true;
                    } else {
                        nRun = 0;
                    }
                }
                //setStatoCorrente();
                semaforo.release();

            } else {
                uSommaStat += jobCorrenteCpu.getTempoRisposta();
                nOss++;

                if ((nOss - 1) == n0) {
                    y[nRun - 1] = n0;
                    x[nRun - 1] = uSommaStat;
                    stopSequenziatore = true;
                    nRun++;
                    statoEquilibrio();
                }

                if ((nRun - 1) == pRun) {
                    cal.setSimulazione(new Evento(cal.getClock(), TipoEvento.FINE_SIMULAZIONE));
                }
            }
        }
        jobCorrenteCpu = null;

        if (!cpuQueue.isEmpty()) {
            jobCorrenteCpu = (Job) cpuQueue.togli();
            jobCorrenteCpu.setTempoProcessamento(genCentroCpu.next());
            cal.setCpu(new Evento(cal.getClock() + jobCorrenteCpu.getTempoProcessamento(), TipoEvento.FINE_CPU));
        } else {
            cal.setCpu(new Evento(Double.MAX_VALUE, TipoEvento.FINE_CPU));
        }
    }

    private void fineIO() {
        Job temp = jobCorrenteIO.clona();
        jobCorrenteIO = null;
        if (jobCorrenteCpu == null) {
            jobCorrenteCpu = temp;
            jobCorrenteCpu.setTempoProcessamento(genCentroCpu.next());
            cal.setCpu(new Evento(cal.getClock() + jobCorrenteCpu.getTempoProcessamento(), TipoEvento.FINE_CPU));
        } else {
            cpuQueue.metti(temp);
        }

        if (!ioQueue.isEmpty()) {
            jobCorrenteIO = (Job) ioQueue.togli();
            jobCorrenteIO.setTempoProcessamento(genCentroIo.next());
            cal.setIo(new Evento(cal.getClock() + jobCorrenteIO.getTempoProcessamento(), TipoEvento.FINE_IO));
        } else {
            cal.setIo(new Evento(Double.MAX_VALUE, TipoEvento.FINE_IO));
        }
    }

    private void fineSimulazione() {
        double xSegn = 0;
        double ySegn = 0;
        for (int jj = 0; jj < pRun; jj++) {
            xSegn += x[jj];
            ySegn += y[jj];
        }
        xSegn /= pRun;
        ySegn /= pRun;

        double xSommaQDiff = 0;
        double ySommaQDiff = 0;
        double xySommaQDiff = 0;
        for (int jj = 0; jj < pRun; jj++) {
            xSommaQDiff += Math.pow(x[jj] - xSegn, 2);
            ySommaQDiff += Math.pow(y[jj] - ySegn, 2);
            xySommaQDiff += (x[jj] - xSegn) * (y[jj] - ySegn);
        }

        double s2_11 = xSommaQDiff / (pRun - 1);
        double s2_22 = ySommaQDiff / (pRun - 1);
        double s2_12 = xySommaQDiff / (pRun - 1);

        double f = xSegn / ySegn;
        double s2 = s2_11 - 2 * f * s2_12 + f * f * s2_22;
        double d = Math.sqrt(s2) / (ySegn * Math.sqrt(pRun));
        double mediaInferiore = f - d * 1.645;
        double mediaSuperiore = f + d * 1.645;

        framePlot1.addMarker(f, Color.GREEN);
        framePlot1.addMarker(mediaInferiore, Color.RED);
        framePlot1.addMarker(mediaSuperiore, Color.RED);
        testoOut += "Punto centrale: " + df.format(f) + " \nIntervallo di confidenza (u1, u2): (" + df.format(mediaInferiore) + ", " + df.format(mediaSuperiore) + ")\n";
        testoOut += "----------------  FINE SIMULAZIONE  ---------------- \n";
        textOutput.setText(testoOut);
        textLimiteInferiore.setText(df.format(mediaInferiore));
        textLimiteSuperiore.setText(df.format(mediaSuperiore));
        textPuntoCentrale.setText(df.format(f));

        buttonAvvia.setEnabled(true);
        buttonAvvia1.setEnabled(true);
        buttonStabile.setEnabled(false);
        buttonStabile.setText("SISTEMA STABILE");
        stopSequenziatore = true;
        fineSimulazione = true;
    }

    public void setStabile() {
        pRun = 40;
        nRun = 0;
        setStatoEquilibrio();
        this.stabile = true;
        statoEquilibrio();
    }

    private void statoEquilibrio() {
        cpuQueue = cpuQueueStabile.clona();
        ioQueue = ioQueueStabile.clona();

        cal = calendarioStabile.clona();

        if (jobCorrenteCpuStabile != null) {
            jobCorrenteCpu = jobCorrenteCpuStabile.clona();
        }
        if (jobCorrenteIOStabile != null) {
            jobCorrenteIO = jobCorrenteIOStabile.clona();
        }
        uSommaStat = 0d;
        setN0(genRouting.next(50, 100));
        nOss = 0;

        genArrivi.setSeme(semeArriviStabile);
        genCentroCpu.setSeme(semeCentriStabile);
        genRouting.setSeme(semeRoutingStabile);
    }

    private void setStatoEquilibrio() {
        testoOut += " ---> fase statistica con n0 = " + n0 + " <--- \n";
        x = new double[pRun];
        y = new double[pRun];
        cpuQueueStabile = cpuQueue.clona();
        ioQueueStabile = ioQueue.clona();

        calendarioStabile = cal.clona();
        if (jobCorrenteCpu != null) {
            jobCorrenteCpuStabile = jobCorrenteCpu.clona();
            jobCorrenteCpu = null;
        }
        if (jobCorrenteIO != null) {
            jobCorrenteIOStabile = jobCorrenteIO.clona();
            jobCorrenteIO = null;
        }

        semeArriviStabile = genArrivi.getSeme();
        semeCentriStabile = genCentroCpu.getSeme();
        semeRoutingStabile = genRouting.getSeme();

    }

    public void setN0(int n0) {
        this.n0 = n0;
        stopSequenziatore = false;
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            javax.swing.UIManager.setLookAndFeel(javax.swing.UIManager.getSystemLookAndFeelClassName());
            /*
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("GTK+".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
             */
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(FrameWin.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                new FrameWin().setVisible(true);
            }
        });
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton buttonAvvia;
    private javax.swing.JButton buttonAvvia1;
    private javax.swing.JButton buttonStabile;
    private mls.FramePlot framePlot1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JSeparator jSeparator4;
    private javax.swing.JSeparator jSeparator5;
    private javax.swing.JTextField textCodaCPU;
    private javax.swing.JTextField textCodaIO;
    private javax.swing.JTextField textGeneratoreArrivi;
    private javax.swing.JTextField textGeneratoreCentri;
    private javax.swing.JTextField textLimiteInferiore;
    private javax.swing.JTextField textLimiteSuperiore;
    private javax.swing.JTextPane textOutput;
    private javax.swing.JFormattedTextField textP;
    private javax.swing.JTextField textPuntoCentrale;
    private javax.swing.JFormattedTextField textTa;
    private javax.swing.JFormattedTextField textTs;
    // End of variables declaration//GEN-END:variables
}
